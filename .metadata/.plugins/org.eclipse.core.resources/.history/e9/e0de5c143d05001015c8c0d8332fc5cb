package com.yong.wf;

import java.io.*;

public class WebFolderDAO {

	private String basepath; // 기본경로
	private String userid; // 사용할 계정정보
	private long totalsize, usedsize, freesize;
	private String crpath;

	public WebFolderDAO() {
		totalsize = 1024 * 1024 * 20;
		usedsize = 0;
		freesize = 0;
	}

	public String getBasepath() {
		return basepath;
	}

	public void setBasepath(String basepath) {
		this.basepath = basepath;
	}

	public String getUserid() {
		return userid;
	}

	public void setUserid(String userid) {
		this.userid = userid;
	}

	public long getTotalsize() {
		return totalsize;
	}

	public void setTotalsize(long totalsize) {
		this.totalsize = totalsize;
	}

	public long getUsedsize() {
		return usedsize;
	}

	public void setUsedsize(long usedsize) {
		this.usedsize = usedsize;
	}

	public long getFreesize() {
		return freesize;
	}

	public void setFreesize(long freesize) {
		this.freesize = freesize;
	}

	public String getCrpath() {
		return crpath;
	}

	public void setCrpath(String crpath) {
		this.crpath = crpath;
	}

	/** 사용자 폴더 만들기 관련 메서드 */
	public void userFolderExists() {

		File f = new File(basepath + "/" + userid);
		if (!f.exists()) {
			f.mkdir();
		}

		usedsize = 0;
		settingUsedSize(f);
		freesize = totalsize - usedsize;
	}

	/** 실제 용량 계산 관련 메서드 */
	public void settingUsedSize(File f) {

		File files[] = f.listFiles();

		for (int i = 0; i < files.length; i++) {
			if (files[i].isFile()) {
				usedsize += files[i].length();
			} else {
				settingUsedSize(files[i]); // 재귀 함수 호출
			}
		}
	}

	public void deleteFile(File f) {
		if (f.isFile()) {
			f.delete();
		} else {
			File files[] = f.listFiles();
			for (int i = 0; i < files.length; i++) {
				if (files[i].isFile()) {
					files[i].delete();
				} else {
					deleteFile(files[i]);
				}
			}
		}
	}

}
